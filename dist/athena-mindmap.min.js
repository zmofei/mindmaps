var AthenaMindmap;(()=>{"use strict";var t=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e={};(()=>{var i,o;t(e),function(t){t.Root="ROOT",t.Node="NODE"}(i||(i={})),function(t){t.Edit="Edit",t.Default="Default"}(o||(o={}));var n=10,r=function(){function t(){var t=this,e=this.box=document.createElement("div");e.style.position="absolute",e.style.zIndex="999",this.dom=document.createElement("div"),this.dom.innerHTML="Hello",this.dom.contentEditable="true",this.dom.style.font="14px Arial",this.dom.style.position="absolute",this.dom.style.left="1px",this.dom.style.top="0",this.dom.style.whiteSpace="nowrap",this.dom.style.minWidth="40px",this.dom.style.transform="translate(0, -100%)",e.appendChild(this.dom),document.body.style.position="relative",document.body.appendChild(e),this.dom.addEventListener("keydown",(function(e){"Tab"===e.key&&(e.returnValue=!1,t.events.new=t.events.new||[],t.events.new.forEach((function(e){e({father:t.changeNode.id,after:null})})))})),this.dom.addEventListener("keypress",(function(t){"Enter"===t.key&&(t.returnValue=!1)})),this.dom.addEventListener("keyup",(function(e){"Enter"===e.key&&(t.events.done.forEach((function(e){e({father:t.changeNode.fatherId,after:t.changeNode.id})})),e.preventDefault())})),this.dom.addEventListener("input",(function(e){t.changeNode.context=t.dom.innerText.replace(/\n/gi,"")})),this.events={}}return t.prototype.show=function(t,e,i,o,n,r){if(this.lastPosition,this.changeNode=r,this.box.style.display="inline-block",this.dom.style.transformOrigin="bottom left",this.box.style.transform="translate("+t+"px, "+e+"px) scale("+n/2+")",r.id!==this.lastNodeId){this.dom.innerText=r.context;var s=document.createRange(),a=window.getSelection();s.selectNodeContents(this.dom),a.removeAllRanges(),a.addRange(s),this.lastNodeId=r.id}this.lastPosition={x:t,y:e,scale:n}},t.prototype.hide=function(){this.lastNodeId=null,this.box.style.display="none"},t.prototype.onChange=function(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)},t}(),s=function(){return(s=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},a=new r,h=function(){function t(t,e){var n;void 0===e&&(e={context:"",fatherId:null});var r=(+new Date).toString(32)+Math.random().toString(32);this.id=r,this.ctx=t,this.x=0,this.y=0,this.type=null!==(n=e.type)&&void 0!==n?n:i.Node,this._state=o.Default,this.context=e.context,this.fatherId=e.fatherId||null,this.childrenSumHeight=this.outerHeight}return t.prototype.computerSize=function(){this.ctx.font="14px Arial";var t=this.ctx.measureText(this._context);this.contextWidth=Math.max(t.width,40),this.contextHeight=t.fontBoundingBoxAscent+t.fontBoundingBoxDescent,this.boxWidth=this.contextWidth+20,this.boxHeight=this.contextHeight+20,this.outerHeight=this.boxHeight+20,this.outerWidth=this.boxWidth+20},Object.defineProperty(t.prototype,"context",{get:function(){return this._context},set:function(t){var e,i,o;this._context=t,this.computerSize(),null===(e=this.bindTree)||void 0===e||e.shakeTree(),null===(o=null===(i=this.bindTree)||void 0===i?void 0:i.graph)||void 0===o||o.draw()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(t){t===o.Edit?this.bindTree.editoringNode=this:this.bindTree.editoringNode=null,this._state=t},enumerable:!1,configurable:!0}),t}(),d=function(){function t(t,e){var o=this;void 0===e&&(e={x:0,y:0,context:"",type:i.Root}),this.graph=t;var n=this.ctx=t.ctx,r=new h(n,s(s({},e),{type:i.Root}));this.rootid=r.id,this.tree={},this.tree[this.rootid]=r,this.nodesRef=this.nodesRef||{},this.nodesRef[this.rootid]=r,r.fatherId&&this.tree[r.fatherId]&&(r.father=this.tree[r.fatherId]),r.bindTree=this,this.editor=a,a.onChange("done",(function(t){t.father,t.after,o.editoringNode=null,o.graph.draw()}))}return t.prototype.addNode=function(t,e,i,o){void 0===t&&(t={context:""});var n=e||this.rootid,r=this.nodesRef[n],a=new h(this.ctx,s(s({},t),{fatherId:n})),d=r.children=r.children||[];if(i){var l=d.findIndex((function(t){return t.id===i}));if(-1===l)return!1;d.splice(l+1,0,a)}else d.push(a);o&&(this.graph.editItem=a,this.editoringNode=a),this.nodesRef[a.id]=a,a.fatherId&&this.tree[a.fatherId]&&(a.father=r),a.bindTree=this;for(var c=d.length<=1?0:a.outerHeight,f=a;f;){var u=f.fatherId,x=this.nodesRef[u];u&&x?(x.childrenSumHeight+=c,f=x):f=null}return this.shakeTree(),this.graph.draw(),a.id},t.prototype.shakeTree=function(){for(var t=this,e=[{info:{x:0,fatherY:0,fatherX:0},items:Object.keys(this.tree).map((function(e){return t.nodesRef[e]}))}],i=[],n=[],r=[],s=function(){var t=e.shift(),s=t.info,a=t.items,h=0;a.forEach((function(t,e){h+=t.childrenSumHeight}));var d=s.fatherY-h/2,l=1===a.length;a.forEach((function(t,a){var h;l?h=s.fatherY:(h=d+t.childrenSumHeight/2,d+=t.childrenSumHeight),t.x=s.x,t.y=h,i.push([t,{x:s.x,y:h}]),n.push([t,{x:s.x,y:h}]),s.father&&r.push([s.fatherX+s.father.boxWidth,s.fatherY,s.x,h]),t.state,o.Edit;var c=t.children;c&&e.push({info:{x:s.x+t.boxWidth+100,fatherY:h,fatherX:s.x,father:t},items:c})}))};e.length>0;)s();this.boardList=i,this.textList=n,this.linkList=r},t.prototype.drawBoard=function(){var t=this,e=this.boardList||[],o=this.ctx,r=[];o.save();var s={};e.forEach((function(t){var e=t[0];e.selected&&r.push(e),s[e.type]=s[e.type]||{type:e.type,list:[]},s[e.type].list.push(t)})),Object.keys(s).forEach((function(e){var o=s[e];!function(t,e,o){e.save(),e.strokeStyle="#e99b47",t===i.Root?(e.beginPath(),o.forEach((function(t){var i=t[0],o=t[1],r=(i.context,i.boxHeight),s=i.boxWidth,a=(i.outerHeight,o.x),h=o.y;h+=i.boxHeight/2,e.translate(a+n,h-i.boxHeight/2),e.lineWidth=4,e.moveTo(-10,0),e.lineTo(-10,-r/2+6),e.arc(-4,-r/2+6,6,Math.PI,1.5*Math.PI),e.lineTo(s-n-6,-r/2),e.arc(s-n-6,-r/2+6,6,1.5*Math.PI,2*Math.PI),e.lineTo(s-n,r/2-6),e.arc(s-n-6,r/2-6,6,2*Math.PI,.5*Math.PI),e.lineTo(-4,r/2),e.arc(-4,r/2-6,6,Math.PI/2,Math.PI),e.lineTo(-10,0),e.translate(-(a+n),-(h-i.boxHeight/2))})),e.closePath(),e.stroke(),e.fillStyle="white",e.fill()):t===i.Node&&(e.beginPath(),o.forEach((function(t){var i=t[0],o=t[1],r=(i.context,i.boxHeight),s=(i.boxWidth,i.outerHeight,o.x),a=o.y;e.translate(s+n,a-i.boxHeight/2),e.lineCap="round",e.lineWidth=2,e.moveTo(-10,r/2),e.lineTo(i.boxWidth-n,r/2),e.translate(-(s+n),-(a-i.boxHeight/2))})),e.closePath(),e.stroke()),e.restore()}(o.type,t.ctx,o.list)})),o.restore(),o.save(),null==r||r.forEach((function(e){t.ctx.fillStyle="rgba(0,102,255,0.2)",e.type===i.Root?t.ctx.fillRect(e.x,e.y-e.boxHeight/2,e.boxWidth,e.boxHeight):t.ctx.fillRect(e.x,e.y-e.boxHeight,e.boxWidth,e.boxHeight)})),o.restore(),window.debug&&e.forEach((function(e){var i=e[0],r=e[1],s=r.x,a=r.y;o.save(),o.fillStyle="red",o.translate(s,a),o.fillRect(-2,-2,4,4),o.restore(),o.save(),o.fillStyle="red",o.translate(s+n,a-i.boxHeight/2),t.ctx.strokeStyle="red",o.strokeRect(-10,-i.childrenSumHeight/2,i.boxWidth,i.childrenSumHeight),o.restore(),o.save(),o.translate(s,a),o.translate(n,-i.boxHeight/2),o.strokeRect(0,-i.contextHeight/2,i.contextWidth,i.contextHeight),o.restore(),o.save(),o.strokeStyle="grey",o.translate(s,a),o.translate(-10,-i.boxHeight-10),o.strokeRect(0,0,i.outerWidth,i.outerHeight),o.restore(),o.save(),o.strokeStyle="yellow",o.translate(s,a),o.translate(0,-i.boxHeight),o.strokeRect(0,0,i.boxWidth,i.boxHeight),o.restore(),o.save(),o.translate(s+n,a-i.boxHeight/2),t.ctx.fillStyle="red",o.font="10px Arial",o.fillText(i.childrenSumHeight.toFixed(2).toString(),i.boxWidth,20-i.boxHeight),o.fillText(i.outerHeight.toFixed(2).toString(),i.boxWidth,20-i.boxHeight+10),o.fillText(i.x.toFixed(0).toString()+","+(i.y||0).toFixed(0).toString()+" ",i.boxWidth,20-i.boxHeight+20),o.translate(-(s+n),-(a-i.boxHeight/2)),o.restore()}))},t.prototype.drawText=function(){var t=this,e=this.textList||[],o=this.ctx;o.save(),o.textAlign="left",o.textBaseline="middle",e.forEach((function(e){var r=e[0],s=e[1];if(r===t.editoringNode)return!1;var a=s.x,h=s.y;r.type===i.Root&&(h+=r.boxHeight/2),o.translate(a+n,h-r.boxHeight/2);var d=r.context;r.boxHeight,r.boxWidth,r.outerHeight,o.font="14px Arial",o.fillText(d,0,0),o.translate(-(a+n),-(h-r.boxHeight/2))})),o.restore()},t.prototype.drawLink=function(){var t=this.linkList||[],e=this.ctx;e.save(),e.strokeStyle="#e99b47",e.beginPath(),t.forEach((function(t){var i=t[0],o=t[1],n=t[2],r=t[3],s=Math.abs(r-o),a=(i+n)/2,h=r<o;e.moveTo(i,o),e.lineTo(a-6,o),s/2>=6?(e.quadraticCurveTo(a,o,a,o+(h?-6:6)),e.lineTo(a,r+(h?6:-6)),e.quadraticCurveTo(a,r,a+6,r)):e.bezierCurveTo(a,o,a,r,a+6,r),e.lineTo(n,r)})),e.stroke(),e.closePath()},t.prototype.updateEditor=function(){var t=this.editoringNode,e=window.devicePixelRatio||1;if(t){var o=this.ctx.getTransform(),r=o.a,s=o.e,h=o.f,d=t.x,l=t.y,c=t.contextWidth,f=t.contextHeight,u=[(s+d*r)/e,(h+l*r)/e],x=u[0],v=u[1],p=0,g=0;t.type===i.Node?(p=n*(r/e),g-=n*(r/e)):t.type===i.Root&&(p=n*(r/e),g+=r/e*8),a.show(x+p,v+g,c,f,r,t)}else a.hide()},t.prototype.draw=function(){this.drawBoard(),this.drawText(),this.drawLink(),this.updateEditor()},t}(),l=function(){function t(t){this.dpr=window.devicePixelRatio||1,this.scale=this.dpr,this.size=t,this.offset={x:t.width/2*this.scale,y:t.height/2*this.scale},this.events={};var e=this.canvas=document.createElement("canvas");this.ctx=e.getContext("2d"),window.ctx=this.ctx,this.adjustCanvs(e,t),this.bindEvent();var i,o=window.testNode=new d(this,{x:0,y:0,context:"雅典娜的图"});i=o.addNode({context:"HTTP CODE"});for(var n=o.addNode({context:"1xx"},i),r=0,s=["100 Continue","101 Switching Protocol","102 Processing","103 Early Hints"];r<s.length;r++){var a=s[r];o.addNode({context:a},n)}for(var h=o.addNode({context:"2xx"},i),l=0,c=["200 OK","201 Created","202 Accepted","203 Non-Authoritative Information","204 No Content","205 Reset Content","206 Partial Content"];l<c.length;l++)a=c[l],o.addNode({context:a},h);for(var f=o.addNode({context:"3xx"},i),u=0,x=["300 Multiple Choices","301 Moved Permanently","302 Found","3","3 See Other","304 Not Modified","307 Temporary Redirect","308 Permanent Redirect"];u<x.length;u++)a=x[u],o.addNode({context:a},f);for(var v=o.addNode({context:"4xx"},i),p=0,g=["400 Bad Request","401 Unauthorized","402 Payment Required","403 Forbidden","404 Not Found","405 Method Not Allowed","406 Not Acceptable","407 Proxy Authentication Required","408 Request Timeout","409 Conflict","410 Gone","411 Length Required","412 Precondition Failed","413 Payload Too Large","414 URI Too Long","415 Unsupported Media Type","416 Range Not Satisfiable","417 Expectation Failed","418 I'm a teapot","422 Unprocessable Entity","425 Too Early","426 Upgrade Required","428 Precondition Required","429 Too Many Requests","431 Request Header Fields Too Large","451 Unavailable For Legal Reasons"];p<g.length;p++)a=g[p],o.addNode({context:a},v);for(var y=o.addNode({context:"5xx"},i),m=0,b=["500 Internal Server Error","501 Not Implemented","502 Bad Gateway","503 Service Unavailable","504 Gateway Timeout","505 HTTP Version Not Supported","506 Variant Also Negotiates","507 Insufficient Storage","508 Loop Detected","510 Not Extended","511 Network Authentication Required"];m<b.length;m++)a=b[m],o.addNode({context:a},y);this.nodeTrees=[o]}return t.prototype.adjustCanvs=function(t,e){t.style.width=e.width+"px",t.style.height=e.height+"px",t.width=e.width*this.dpr,t.height=e.height*this.dpr,this.ctx.translate(this.offset.x,this.offset.y),this.ctx.scale(this.dpr,this.dpr)},t.prototype.bindEvent=function(){var t=this,e=this.canvas,n="DONE",r=null,s=null,a=null,h=null;e.addEventListener("mousedown",(function(e){var i;n="PREPARE",a=r=e.offsetX,h=s=e.offsetY,t.editItem&&(null===(i=t.editItem)||void 0===i||(i.state=o.Default),t.editItem=null,t.draw())})),e.addEventListener("mousemove",(function(e){if("PREPARE"===n||"MOVING"===n){var o=t,r=o.dpr,s=o.scale,d=(o.offset,e.offsetX-a),l=e.offsetY-h,c=s/r;h=e.offsetY,a=e.offsetX,n="MOVING",t.ctx.translate(d/c,l/c),t.draw()}else{var f=(e.offsetX*t.dpr-t.offset.x)/t.scale,u=(e.offsetY*t.dpr-t.offset.y)/t.scale,x=null;t.nodeTrees.forEach((function(t){for(var e=t.tree,o=[Object.keys(e).map((function(t){return e[t]}))];o.length>=1;)for(var n=0,r=o.pop();n<r.length;n++){var s=r[n],a=s.x>=0?f>=s.x:f<=s.x,h=[s.y-s.childrenSumHeight,s.y+s.childrenSumHeight],d=u>=Math.min.apply(null,h)&&u<=Math.max.apply(null,h),l=s.children;if(a&&d){var c=f>=s.x&&f<=s.x+s.boxWidth,v=s.type===i.Root?s.boxHeight/2:0,p=u>=s.y-s.boxHeight+v&&u<=s.y+v;if(c&&p){x=s,o.length=0;break}l&&o.push(l)}}})),t.canvas.style.cursor=x?"pointer":"default",t.hover=x}})),e.addEventListener("mouseup",(function(e){e.preventDefault(),n="DONE",a=h=null;var i=t.ctx.getTransform();t.scale=i.a,t.offset={x:i.e,y:i.f}})),e.addEventListener("wheel",(function(e){var i=t,o=i.dpr,n=i.scale,r=i.offset;e.preventDefault();var s=Math.pow(1.01,-e.deltaY),a=n/o;ctx.setTransform(n,0,0,n,r.x,r.y),t.ctx.translate(-r.x/n+e.offsetX/a,-r.y/n+e.offsetY/a),t.ctx.scale(s,s),t.ctx.translate(-(-r.x/n+e.offsetX/a),-(-r.y/n+e.offsetY/a));var h=t.ctx.getTransform();t.scale=h.a,t.offset={x:h.e,y:h.f},t.draw()})),e.addEventListener("click",(function(e){var i,n,a;if(Math.abs(e.offsetX-r)>5||Math.abs(e.offsetY-s)>5)return!1;null===(i=t.selected)||void 0===i||(i.selected=!1),t.hover&&t.selected===t.hover?(t.selected=null,t.hover.state=o.Edit,t.editItem=t.hover):t.hover!==t.editItem&&(null===(n=t.editItem)||void 0===n||(n.state=o.Default),t.editItem=null,t.selected=t.hover,null===(a=t.selected)||void 0===a||(a.selected=!0)),t.draw()})),window.addEventListener("keyup",(function(e){var i=t.nodeTrees[0];if("Enter"===e.key){if(t.editItem)t.editItem.selected=!0,t.selected=t.editItem,t.editItem.state=o.Default,t.editItem=null;else if(t.selected){var n=t.selected,r=n.fatherId,s=n.id;t.selected&&(t.selected.selected=!1),t.selected=null,i.addNode({context:"New Node"},r,s,!0)}t.draw()}}))},t.prototype.draw=function(){var t=this.ctx;if(t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle="#f3f3f4",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore(),window.debug){this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="red",this.ctx.lineWidth=2,this.ctx.moveTo(0,-5),this.ctx.lineTo(0,5),this.ctx.moveTo(-5,0),this.ctx.lineTo(5,0),this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.strokeStyle="#ddd";for(var e=Math.round(this.size.width/10),i=-e;i<e;i+=1)this.ctx.moveTo(-10*i,-this.size.height),this.ctx.lineTo(-10*i,this.size.height);var o=Math.round(this.size.height/10);for(i=-o;i<o;i+=1)this.ctx.moveTo(-this.size.width,-10*i),this.ctx.lineTo(this.size.width,-10*i);this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}(this.nodeTrees||[]).forEach((function(t){t.draw()}))},t}(),c=function(t){var e=getComputedStyle(t),i={width:parseFloat(e.width),height:parseFloat(e.height)};this.coreCanvas=new l(i),this.canvas=this.coreCanvas.canvas,this.ctx=this.coreCanvas.ctx,this.coreCanvas.draw()};new function(t,e){this.container=document.getElementById("container"),this.graph=new c(this.container),console.log("Hello Athena!"),this.container.appendChild(this.graph.canvas)}("container")})(),AthenaMindmap=e})();
//# sourceMappingURL=athena-mindmap.min.js.map